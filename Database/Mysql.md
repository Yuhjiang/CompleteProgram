# Mysql数据库知识点

## 基本操作

### 数据库操作
- 创建数据库 `CREATE DATABASE database_name;`
- 删除数据库 `DROP DATABASE database_name;`

## 数据库概念

### 数据库引擎

#### 1. InnoDB存储引擎
- 支持事务安全表（ACID），支持行锁定和外键。Mysql5.5之后是默认引擎
- 提供了提交、回滚和崩溃恢复能力的事务安全特性
- 为处理巨大数据量的最大性能设计
- 在主内存中缓存数据和索引而维持自己的缓冲池。表和索引放在同一个逻辑表空间中，表空间可以包含多个文件。
- 锁是行级的，粒度小，写操作不会锁定全表，在并发高的时候，效率高。适合update和insert多的表
- 支持外键完整性约束
- 不保存行数，执行 `SELECT COUNT(*) FROM table;`时需要全表扫描。

#### 2. MyISAM存储引擎
- 不支持事务
- 用一个变量保存了整个表的行数，查询快
- 锁是表级的，所以频繁更新数据效率低，适合大量查询的表
- 每个表的最大索引数是64（可以通过编译改变），最大的键长度是1000B（也可以通过编译改变）
- BLOB和TEXT列可以被索引，NULL允许在索引的列中
- 可以把数据文件和索引文件放在不同的目录下
- 每个字符列可以有不同的字符集
- 创建数据库时，产生3个文件，frm存储表定义，MYD是数据文件，MYI是索引文件

### 聚集索引和非聚集索引
- InnoDB是聚集索引，MyISAM是非聚集索引。
- 聚集索引的文件存放在主键索引的叶子节点上，所以InnoDB必须要有主键。主键索引效率高，辅助索引需要查两次，第一次查主键索引，再通过主键查询到数据
- 非聚集索引的数据文件是分离的，索引保存的数据文件的指针，主键索引和辅助索引是分离的。

## 数据库概念

### 事务的4个特性
1. 原子性：事务是在逻辑上不可分割的操作单元，其所有语句要么全都执行要么全都不执行
2. 一致性：逻辑上的保证操作，将数据库从某个一致性状态转换到另一个一致性状态（比如两个共有5000元，互相赚钱都要保证这两个人总和还是5000元）
3. 隔离性：在并发的情况下，避免同时对数据库的多个操作对数据一致性产生影响，需要隔离并发运行的多个事务间的互相影响
4. 一旦事务提交成功，对数据的修改是持久性的。即时发生了系统故障，已提交的事务所做的数据的修改也不会丢失。

### 事务的不进行隔离会产生的问题
1. 脏读：A事务读取了被B事务正在修改但没有提交的数据。B事务在多次修改某个数据，但一直未提交修改。这是另一个A事务来读取被B修改的数据，会造成两个事务的数据不一致
2. 不可重复读：同一个事务中，同一个查询在Time1时刻读取某一行，在time2时刻重新读取这一行数据，发现一行的数据已经被另一个事务修改或删除了。 <i>不可重复读是由于事务并发修改同一条记录导致的</i>
3. 幻读：同一个事务中，同一查询多次执行的时候，由于其他插入操作的事务提交，会导致每次返回不同的结果集。<i>幻读是由于并发事务增加记录导致的</i>

### 事务的四种隔离级别
1. Read Uncommited未提交读：所有事务都可以看到其他未提交事务的执行结果。
2. Read Committed提交读：大多数数据库默认的隔离级别。一个事务从开始直到提交，其他事务都不可读取到期间修改的结果。
3. Repeated Read可重复读：确保同一个事务在多次读取同样的数据时候，得到同样的结果（InnoDB通过MVCC实现）
4. Serializable可串行化：最高的隔离级别，强制事务的排序，强制事务串行执行，使之不能相互冲突。原理是在每个读的数据行上加上共享锁。