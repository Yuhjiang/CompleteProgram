# k8s

## Kubernetes的对象
- 对象三大属性：元数据（metadata）、规范（spec）、状态（status）。通过这三个属性用户可以定义让某个对象
处于给定的状态和表现策略

### 基础的资源操作对象
- 容器组（pod），k8s中最小的资源单位，由位于同一个节点上若干容器组成，彼此共享网络命名空间
和存储卷。pod是短暂的，随时可变的，通常不带有状态，每一个pod中除了应用容器外，还包括一个初始
的pause容器，完成网络和存储空间的初始化
- 服务（service），对外提供某个特定功能的一组pod和所关联的访问配置。k8s通过服务提供唯一的
固定的访问地址（如IP地址或域名）
- 存储卷（volume），提供数据的持久化存储，并支持高级的生命周期管理和参数指定功能，支持多种
本地存储和云存储
- 命名空间（namespace），k8s通过命名空间实现虚拟化，同一组物理资源虚拟为不同的抽象集群，
避免不同租户的资源发生命名冲突，另外可以进行资源限额

### 高级抽象概念——控制器
- 副本集（replicaset）基于pod的抽象，始终维持某个pod的指定副本集的健康实例。不推荐使用
- 部署（deployment）比副本集更高级的抽象，可以管理副本集和pod，并支持升级操作。
- 状态集（statefulset）管理带有状态的应用，可以为pod分配独一无二的身份，确保在重新调配等
操作时不会相互替换
- Daemon集，确保节点上运行某个pod，一般用来采集日志，监控节点
- 任务（job），适用于短期处理场景。任务将创建多个pod，确保给定数目的pod最终正常退出
- 横向pod扩展器，根据pod的使用率，自动调整一个部署内pod的个数，保障服务可用性
- 入口控制器，定义外部访问集群中资源的一组规则，用来提供七层代理和负载均衡服务

### 管理资源的辅助概念
- 标签（label）：键值对，可以标记到资源对象上，对资源进行分类和筛选
- 选择器（selector）：基于标签概念的正则表达式，可通过标签来筛选出一组资源
- 注解（Annotation）：键值对，存放大量任意数据
- 秘密数据（secret）：存放敏感数据
- 名字（name）：用户提供给资源的别名，
- 持久化存储（PersistentVolume)：确保数据不会丢失
- 资源限额（Resource Quotas）：用来限制某个命名空间下对资源的使用
- 安全上下文（Security Context）：应用到容器上的系统安全配置，包括uid，gid...
- 服务账号（service accounts）：操作资源的用户账号

## 容器组
- 最小的管理单位，有一个或多个容器组成。
- k8s围绕容器组进行创建、调度、停止等生命周期管理
- 容器组生命周期
    - 待定：已经被系统接收但容器未就绪
    - 运行：分配到节点，所有容器被创建，至少一个在运行
    - 成功：所有容器都正常退出，不需要重启，任务完成
    - 失败：所有容器退出，至少一个容器是非正常退出
    - 未知：未知状态
    
## 服务
- Service主要是解决pod地址可变的问题
- 服务可以分为以下几种类型
    - ClusterIP：提供一个集群内部的地址，地址只能在集群内解析和访问
    - NodePort：每个集群节点上映射服务到一个静态的本地端口，从集群外部可以直接访问，
    并自动路由到内部自动创建的ClusterIP
    - LoadBalancer：使用外部的路由服务，自动路由访问到自动创建的NodePort和ClusterIP
    - ExternalName：将服务映射到externalName域指定的地址

## 存储卷
- emptyDir：Pod创建时，在节点上创建一个空的挂在目录，挂载到容器内，当pod从节点离开后，
自动删除挂载目录内数据。适用于非持久化的存储
- hostPath：将节点上已经存在的目录挂载到pod，pod退出后，节点上数据会被保留
- gcePersistentDisk:使用AWS的Persistent Disk服务，pod退出后数据保留
- awsElasticBlockStore: AWS的EBS Volume服务，持久化保存数据
- nfs：使用NFS协议的网络存储，持久化
- gitRepo：挂载一个空目录到pod，然后clone指定的git仓库代码到里面
- secret：用来传递敏感信息，基于内存的tmpfs，挂载临时秘密文件